<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ã‚¿ãƒƒãƒ•æŒ‡ç¤º - 4ç•ªå‡ºå£</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <div class="container">
        <div class="card">
            <h1>ğŸ“‹ ã‚¹ã‚¿ãƒƒãƒ•æŒ‡ç¤º</h1>

            <div class="status-display">
                <h2>ç¾åœ¨ã®çŠ¶æ…‹</h2>
                <div class="status-item">
                    <span class="status-label">å›æ•°:</span>
                    <span class="status-value" id="count-display">0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">é€²è¡Œåº¦åˆ:</span>
                    <span class="status-value" id="progress-display">0</span>
                </div>
            </div>

            <div class="status-display">
                <h2>æ¬¡ã®ä½œæ¥­å†…å®¹</h2>
                <div style="text-align: center;">
                    <div class="status-item">
                        <span class="status-label">ã‚¤ãƒ™ãƒ³ãƒˆãƒŠãƒ³ãƒãƒ¼:</span>
                        <span class="status-value" id="event-number-display">-</span>
                    </div>
                    <img id="event-image" class="image-display" src="" alt="ã‚¤ãƒ™ãƒ³ãƒˆç”»åƒ" style="display: none;">
                    <div id="no-image-message" style="color: #999; margin: 20px 0; font-size: 1.2em;">
                        ç”»åƒã‚’èª­ã¿è¾¼ã¿ä¸­...
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-large" id="status-btn">
                    ä½œæ¥­ä¸­
                </button>
            </div>

            <div class="button-group">
                <a href="/" class="nav-link">
                    <button class="btn">ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
                </a>
            </div>
        </div>
    </div>

    <script src="/js/websocket.js"></script>
    <script>
        const countDisplay = document.getElementById('count-display');
        const progressDisplay = document.getElementById('progress-display');
        const eventNumberDisplay = document.getElementById('event-number-display');
        const eventImage = document.getElementById('event-image');
        const noImageMessage = document.getElementById('no-image-message');
        const statusBtn = document.getElementById('status-btn');

        let currentStatus = false;

        wsClient.onMessage((data) => {
            if (data.type === 'state') {
                countDisplay.textContent = data.data.count;
                progressDisplay.textContent = data.data.progress;
                eventNumberDisplay.textContent = data.data.nextEventNumber;
                currentStatus = data.data.staffStatus;

                // ç”»åƒã‚’æ›´æ–°
                const imagePath = `/image/${data.data.nextEventNumber}.png`;
                eventImage.src = imagePath;

                // ç”»åƒã®èª­ã¿è¾¼ã¿ç¢ºèª
                eventImage.onload = () => {
                    eventImage.style.display = 'block';
                    noImageMessage.style.display = 'none';
                };

                eventImage.onerror = () => {
                    eventImage.style.display = 'none';
                    noImageMessage.style.display = 'block';
                    noImageMessage.textContent = `ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${imagePath}`;
                };

                // ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºã‚’æ›´æ–°
                updateButtonStatus();
            }
        });

        function updateButtonStatus() {
            if (currentStatus) {
                statusBtn.textContent = 'âœ… å®Œäº†';
                statusBtn.className = 'btn btn-success btn-large';
            } else {
                statusBtn.textContent = 'â³ ä½œæ¥­ä¸­';
                statusBtn.className = 'btn btn-warning btn-large';
            }
        }

        statusBtn.addEventListener('click', () => {
            if (!currentStatus) {
                currentStatus = true;
                wsClient.send({ type: 'setStaffStatus', value: true });
                updateButtonStatus();
            }
        });
    </script>
</body>

</html>